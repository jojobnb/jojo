var canvas,gl,shaderScript,shaderSource,vertexShader,fragmentShader,buffer,locationOfTime,locationOfResolution,locationOfMouse,locationOfMass,locationOfclickedTime,mouse,bgUrl="https://images.unsplash.com/photo-1462331940025-496dfbfc7564?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1427&q=80",blackholeMass=1500,curblackholeMass=0,originY=window.innerHeight,originX=window.innerWidth,startTime=(new Date).getTime(),currentTime=0,clicked=!1,clickedTime=0;function init(e){canvas=document.getElementById("screen"),gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl"),canvas.width=window.innerWidth>=window.innerHeight?window.innerWidth:window.innerHeight,canvas.height=window.innerWidth>=window.innerHeight?window.innerWidth:window.innerHeight,mouse={x:originX/2,y:-originY/2+canvas.height,moved:!1},$(document).mousemove((function(e){mouse.x=e.pageX,mouse.y=-e.pageY+canvas.height,mouse.moved=!0})),gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight),buffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,buffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),gl.STATIC_DRAW),shaderScript=document.getElementById("2d-vertex-shader"),shaderSource=shaderScript.text,vertexShader=gl.createShader(gl.VERTEX_SHADER),gl.shaderSource(vertexShader,shaderSource),gl.compileShader(vertexShader),shaderScript=document.getElementById("2d-fragment-shader"),shaderSource=shaderScript.text,fragmentShader=gl.createShader(gl.FRAGMENT_SHADER),gl.shaderSource(fragmentShader,shaderSource),gl.compileShader(fragmentShader),program=gl.createProgram(),gl.attachShader(program,vertexShader),gl.attachShader(program,fragmentShader),gl.linkProgram(program),gl.useProgram(program),locationOfResolution=gl.getUniformLocation(program,"u_resolution"),locationOfMouse=gl.getUniformLocation(program,"u_mouse"),locationOfMass=gl.getUniformLocation(program,"u_mass"),locationOfTime=gl.getUniformLocation(program,"u_time"),locationOfclickedTime=gl.getUniformLocation(program,"u_clickedTime"),gl.uniform2f(locationOfResolution,canvas.width,canvas.height),gl.uniform2f(locationOfMouse,mouse.x,mouse.y),gl.uniform1f(locationOfMass,1e-5*curblackholeMass),gl.uniform1f(locationOfTime,currentTime),gl.uniform1f(locationOfclickedTime,clickedTime);var i=gl.getAttribLocation(program,"a_texCoord"),r=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,r),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),gl.STATIC_DRAW),gl.enableVertexAttribArray(i),gl.vertexAttribPointer(i,2,gl.FLOAT,!1,0,0);var o=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,o),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,e),render()}function render(){var e=(new Date).getTime();currentTime=(e-startTime)/1e3,curblackholeMass<blackholeMass-50&&(curblackholeMass+=.03*(blackholeMass-curblackholeMass)),clicked?clickedTime+=.03:clickedTime>0&&0==clicked&&(clickedTime+=-.015*clickedTime),0==mouse.moved&&(mouse.y=-originY/2+Math.sin(.7*currentTime)*(.25*originY)+canvas.height,mouse.x=originX/2+Math.sin(.6*currentTime)*(-.35*originX)),gl.uniform1f(locationOfMass,1e-5*curblackholeMass),gl.uniform2f(locationOfMouse,mouse.x,mouse.y),gl.uniform1f(locationOfTime,currentTime),gl.uniform1f(locationOfclickedTime,clickedTime),window.requestAnimationFrame(render,canvas),positionLocation=gl.getAttribLocation(program,"a_position"),gl.enableVertexAttribArray(positionLocation),gl.vertexAttribPointer(positionLocation,2,gl.FLOAT,!1,0,0),gl.drawArrays(gl.TRIANGLES,0,6)}$(document).mousedown((function(){clicked=!0})),$(document).mouseup((function(){clicked=!1})),window.addEventListener("load",(function(e){var i=null,r=new Image;r.crossOrigin="Anonymous",r.src=bgUrl,r.onload=function(){i=setInterval((()=>{document.getElementById("screen")&&(init(r),clearInterval(i))}),100)}})),window.addEventListener("resize",(function(e){canvas.width=window.innerWidth>=window.innerHeight?window.innerWidth:window.innerHeight,canvas.height=window.innerWidth>=window.innerHeight?window.innerWidth:window.innerHeight,gl.viewport(0,0,canvas.width,canvas.height),locationOfResolution=gl.getUniformLocation(program,"u_resolution")}));